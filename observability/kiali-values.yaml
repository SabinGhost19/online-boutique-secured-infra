# =============================================================================
# kiali-values.yaml
# Configurație pentru Kiali Operator și Kiali CR
# =============================================================================

# Configurație pentru Kiali CR (Custom Resource)
cr:
  # Creează automat Kiali CR la instalare
  create: true
  
  # Namespace-ul unde va fi instalat Kiali
  namespace: istio-system
  
  # Specificațiile Kiali CR
  spec:
    # =========================================================================
    # AUTHENTICATION
    # =========================================================================
    auth:
      # Strategia de autentificare:
      # - anonymous: fără autentificare (DOAR pentru development)
      # - token: ServiceAccount token (recomandat pentru început)
      # - openid: OpenID Connect (recomandat pentru producție)
      # - openshift: pentru OpenShift
      strategy: "token"
    
    # =========================================================================
    # DEPLOYMENT
    # =========================================================================
    deployment:
      # Namespace-uri accesibile pentru Kiali
      # "**" = toate namespace-urile
      accessible_namespaces:
        - "**"
      
      # Număr de replici
      replicas: 1
      
      # Resurse
      resources:
        requests:
          cpu: "100m"
          memory: "128Mi"
        limits:
          cpu: "500m"
          memory: "512Mi"
      
      # Service account
      service_type: "ClusterIP"
      
      # Image (lasă default pentru ultimul version)
      # image_name: quay.io/kiali/kiali
      # image_version: ""
      
      # Pod annotations
      pod_annotations: {}
      
      # Pod labels
      pod_labels: {}
      
      # Affinity
      affinity:
        pod_anti: {}
        node: {}
      
      # Tolerations
      tolerations: []
      
      # Node selector
      node_selector: {}
      
      # Logging level
      verbose_mode: "3"  # 0=minimal, 3=debug
    
    # =========================================================================
    # EXTERNAL SERVICES
    # =========================================================================
    external_services:
      # Prometheus configuration
      prometheus:
        # URL-ul serviciului Prometheus
        url: "http://prometheus-server.monitoring-online-boutique.svc.cluster.local:80"
        
        # Auth (dacă Prometheus necesită autentificare)
        # auth:
        #   type: "basic"
        #   username: ""
        #   password: ""
      
      # Grafana configuration
      grafana:
        enabled: true
        # URL intern pentru API calls
        internal_url: "http://grafana.monitoring-online-boutique.svc.cluster.local:80"
        # URL extern pentru linkuri în UI
        # external_url: "https://grafana.your-domain.com"
        # Dashboards specifice Istio
        dashboards:
          - name: "Istio Service Dashboard"
            variables:
              namespace: "var-namespace"
              service: "var-service"
          - name: "Istio Workload Dashboard"
            variables:
              namespace: "var-namespace"
              workload: "var-workload"
      
      # Tracing (Jaeger/Zipkin)
      tracing:
        enabled: true
        # URL intern
        internal_url: "http://tracing.istio-system.svc.cluster.local:16686"
        # URL extern pentru linkuri
        # external_url: "https://jaeger.your-domain.com"
        # Provider: jaeger, zipkin, tempo
        provider: "jaeger"
        use_grpc: false
      
      # Istio configuration
      istio:
        root_namespace: istio-system
        component_status:
          enabled: true
          components:
            - app_label: "istiod"
              is_core: true
              is_proxy: false
            - app_label: "istio-ingressgateway"
              is_core: true
              is_proxy: true
              namespace: istio-ingress
    
    # =========================================================================
    # SERVER CONFIGURATION
    # =========================================================================
    server:
      # Port pentru web UI
      port: 20001
      
      # Web root path
      web_root: "/"
      
      # Metrics enabled
      metrics_enabled: true
      metrics_port: 9090
      
      # Web FQDN (pentru generare de linkuri)
      # web_fqdn: "kiali.your-domain.com"
      # web_schema: "https"
    
    # =========================================================================
    # ISTIO CONFIG MAP
    # =========================================================================
    istio_labels:
      app_label_name: "app"
      version_label_name: "version"
    
    # =========================================================================
    # KIALI FEATURES
    # =========================================================================
    kiali_feature_flags:
      # Validări Istio
      validations:
        skip_wildcard_gateway_hosts: false
      
      # UI features
      ui_defaults:
        graph:
          find_options:
            - auto_select: true
              description: "Unhealthy nodes"
              expression: "! healthy"
            - auto_select: false
              description: "Services with HTTP errors"
              expression: "httpout >= 400"
          traffic:
            grpc: "requests"  # none, requests, sent, received, total
            http: "requests"  # none, requests
            tcp: "sent"       # none, sent, received, total
